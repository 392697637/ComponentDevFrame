{"version":3,"sources":["webpack:///./node_modules/olMap/src/mapHelper/template/mesureTooltip.html","webpack:///./node_modules/olMap/src/mapHelper/control/tool_measureLength.js","webpack:///./node_modules/olMap/src/mapHelper/template/helpTooltip.html"],"names":["module","exports","Object","defineProperty","__webpack_exports__","value","$","__WEBPACK_IMPORTED_MODULE_0__common_comLib__","__webpack_require__","__WEBPACK_IMPORTED_MODULE_1__control_baseControl__","__WEBPACK_IMPORTED_MODULE_2__enum_controlType__","__WEBPACK_IMPORTED_MODULE_3__enum_mapId__","__WEBPACK_IMPORTED_MODULE_4__common_caculator__","__WEBPACK_IMPORTED_MODULE_5__template_mesureTooltip_html__","__WEBPACK_IMPORTED_MODULE_5__template_mesureTooltip_html___default","n","__WEBPACK_IMPORTED_MODULE_6__template_helpTooltip_html__","tool_measureLength","inhertObject","pinTip","coordinate","this","count","curTooltip","target","attr","find","empty","append","lineId","curLineId","className","marker","setPosition","pinToolTips","push","createMeasureTooltip","x","y","container","injects","mapContainer","mapHelper","getMapHelper","_id","getRandom","a","format","id","measureTooltipElement","options","toolTipSelector","addOverlay","offset","positioning","canMutity","ol","undefined","controlBarContainer","controlBar","helpTipSelector","drawType","type","tool","init","extend","lines","sketch","source","call","self","delegate","tipDom","parent","filter","map","clear","tmpDrawLayer","removeOverlay","active","drawObj","draw","startDraw","devt","feature","tooltipCoord","listener","getGeometry","on","evt","output","geom","Polygon","formatArea","getArea","getInteriorPoint","getCoordinates","LineString","_geom84","transForm","spatialReference","formatLength","getLength","getLastCoordinate","bind","endDraw","Observable","unByKey","getPosition","point","Point","addFeature","Feature","removeClass","setCurTool","click","onceCall","destroy"],"mappings":"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","file":"static/js/6.875779bf6e75aa2a99f9.js","sourcesContent":["module.exports = \"<div id='lengthLabel' class=\\\"tooltip tooltip-measure\\\" data-line=\\\"{lineId}\\\" data-id=\\\"{id}\\\"  data-count=\\\"{count}\\\" >\\r\\n    <a class=\\\"ol-popup-closer hidden\\\" href=\\\"javascript:void(0);\\\"></a>\\r\\n    <div class=\\\"content\\\"></div>\\r\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/olMap/src/mapHelper/template/mesureTooltip.html\n// module id = QWp6\n// module chunks = 5 6 7","import comLib from '../common/comLib'\r\nimport baseControl from '../control/baseControl'\r\nimport controlType from '../enum/controlType'\r\nimport mapId from '../enum/mapId';\r\n\r\nimport caculator from '../common/caculator'\r\n\r\n//html\r\nimport measureTooltipHtml from '../template/mesureTooltip.html'\r\nimport helpTooltipHtml from '../template/helpTooltip.html'\r\n\r\nvar tool_measureLength = comLib.inhertObject(baseControl);\r\n\r\ntool_measureLength.injects = {\r\n    ol: undefined,\r\n    mapContainer: undefined,  // 地图所在div\r\n    controlBarContainer: undefined, //bar 所在的div\r\n    controlBar: undefined, // bar\r\n    getMapHelper: undefined\r\n}\r\n\r\ntool_measureLength.options = {\r\n    toolTipSelector: '#lengthLabel',\r\n    helpTipSelector: '#toolTipBtn', //TODO: NOT USING\r\n    drawType: 'LineString'\r\n}\r\n\r\ntool_measureLength.type = controlType.tool;\r\n\r\n\r\n//初始化, 只调用一次\r\ntool_measureLength.init = function (injects, options) {\r\n\r\n    var self = this;\r\n\r\n    this.injects = $.extend(true, {}, this.injects, injects)\r\n    this.options = $.extend(true, {}, this.options, options)\r\n\r\n    self.lines = [];\r\n    self.curLineId = \"\";\r\n    self.pinToolTips = []; //已经定了的tip\r\n    self.curTooltip = undefined; //当前活动浮动的tip\r\n    self.sketch = undefined; //图形feature\r\n    self.count = 0; //第几个点了\r\n    self.source = undefined;\r\n\r\n    createMeasureTooltip.call(this);\r\n    bindEvents.call(self);\r\n    //createHelpTooltip.call(this);\r\n}\r\n\r\n//激活,每次点击就调用\r\ntool_measureLength.active = function () {\r\n    var self = this;\r\n    var mapHelper = self.injects.getMapHelper();\r\n    var ol = self.injects.ol;\r\n\r\n\r\n    if (!self.curTooltip) {\r\n        createMeasureTooltip.call(self)\r\n    }\r\n\r\n    self.drawObj = mapHelper.draw(\r\n        {\r\n            startDraw: startDrawCallback.bind(self),\r\n            endDraw: endDrawCallback.bind(self),\r\n            click: onMapClickCallback.bind(self),\r\n            // doubleClick: onMapDoubleClickCallback.bind(self)\r\n        },\r\n        self.options.drawType,\r\n        undefined,\r\n        {\r\n            onceCall: true\r\n        }\r\n    )\r\n\r\n\r\n}\r\n\r\ntool_measureLength.destroy = function () {\r\n    var self = this;\r\n    // endDrawCallback.call(this)\r\n    debugger\r\n    //移除事件监听\r\n    ol.Observable.unByKey(self.listener);\r\n    self.sketch = null;\r\n\r\n}\r\n\r\nfunction bindEvents() {\r\n    var self = this;\r\n    var container = self.injects.mapContainer;\r\n    var mapHelper = self.injects.getMapHelper();\r\n\r\n    container.delegate(`${self.options.toolTipSelector} .ol-popup-closer`, 'click', function () {\r\n\r\n\r\n        var tipDom = $(this).parent('.tooltip-measure:first');\r\n        var lineId = tipDom.attr('data-line');\r\n        var markers = self.pinToolTips.filter(x => x.lineId == lineId).map(x => x.marker);\r\n        //TODO: only remove my draws\r\n        mapHelper.clear(mapId.tmpDrawLayer);\r\n        mapHelper.removeOverlay(true);\r\n\r\n    })\r\n}\r\n\r\n//开始启动画线工具时, 做一些事件绑定初始化之类的\r\nfunction startDrawCallback(devt, source) {\r\n    var self = this;\r\n    var ol = self.injects.ol;\r\n    var mapHelper = self.injects.getMapHelper();\r\n\r\n    //开始一条新的线\r\n    self.curLineId = comLib.getRandom();\r\n    self.lines.push(self.curLineId);\r\n\r\n    self.source = source;\r\n    self.sketch = devt.feature;\r\n    self.count = 0;\r\n    //提示框的坐标\r\n    var tooltipCoord = devt.coordinate;\r\n    self.listener = self.sketch.getGeometry().on('change', function (evt) {\r\n        //The event target.\r\n        //获取绘制的几何对象\r\n        var geom = evt.target;\r\n        //定义一个输出对象，用于记录面积和长度\r\n        var output;\r\n        if (geom instanceof ol.geom.Polygon) { //FIXME: 不管            \r\n            //输出多边形的面积\r\n            output = comLib.formatArea(geom.getArea());\r\n            //Return an interior point of the polygon.\r\n            //获取多变形内部点的坐标\r\n            tooltipCoord = geom.getInteriorPoint().getCoordinates();\r\n        } else if (geom instanceof ol.geom.LineString) {\r\n            //输出多线段的长度\r\n            var _geom84 = mapHelper.transForm(geom, mapHelper.spatialReference, \"EPSG:4326\");\r\n            output = comLib.formatLength(caculator.getLength(_geom84));\r\n            // output = comLib.formatLength(geom.getLength());\r\n            //Return the last coordinate of the geometry.\r\n            //获取多线段的最后一个点的坐标\r\n            tooltipCoord = geom.getLastCoordinate();\r\n        }\r\n\r\n        //设置测量提示框的内标签为最终输出结果\r\n        $(self.curTooltip.target).find('.content').empty().append(`<span>${output}</span>`);\r\n        //设置测量提示信息的位置坐标\r\n        // self.measureTooltip.setPosition(tooltipCoord);\r\n        self.curTooltip.marker.setPosition(tooltipCoord);\r\n        // mapHelper.addOverlay(self.measureTooltip)\r\n    });\r\n}\r\n\r\n//结束了一次编辑, 一次绘制结束, 把当前的定位\r\nfunction endDrawCallback() {\r\n\r\n    var self = this;\r\n    var ol = self.injects.ol\r\n    var mapHelper = self.injects.getMapHelper();\r\n\r\n\r\n    // createMeasureTooltip.call(self);\r\n    //Removes an event listener using the key returned by on() or once().\r\n    //移除事件监听\r\n    ol.Observable.unByKey(self.listener);\r\n    self.sketch = null;\r\n    //移除地图单击事件\r\n    // map.removeEventListener('singleclick');\r\n    // map.removeInteraction(draw);\r\n\r\n    //TODO:提示框\r\n    //绘制最后一个点\r\n\r\n    var coordinate = self.curTooltip.marker.getPosition()\r\n    pinTip.call(self, coordinate);\r\n    var point = new ol.geom.Point(coordinate);\r\n    self.source.addFeature(new ol.Feature(point));\r\n    //出现close    \r\n    $(self.curTooltip.target).find('.ol-popup-closer').removeClass('hidden')\r\n    self.curTooltip = null;\r\n    self.count = 0;\r\n\r\n\r\n    //因为是onceCall 所以end之后要取消工具    \r\n    mapHelper.setCurTool(undefined)\r\n    \r\n\r\n}\r\n\r\nfunction onMapClickCallback(evt) {\r\n    var self = this;\r\n    var ol = self.injects.ol;\r\n\r\n    //设置测量提示信息的位置坐标，用来确定鼠标点击后测量提示框的位置\r\n\r\n\r\n    pinTip.call(self, evt.coordinate);\r\n\r\n\r\n    // self.measureTooltip.marker.setPosition(evt.coordinate);\r\n    //如果是第一次点击，则设置测量提示框的文本内容为起点\r\n    // if (self.count == 0) {\r\n    //     $(self.measureTooltipElement).attr('data-count', self.count).find('.content').empty().append('<span>起点</span>');\r\n    //     // self.measureTooltipElement.innerHTML = \"起点\";\r\n    // }\r\n    //根据鼠标点击位置生成一个点\r\n    var point = new ol.geom.Point(evt.coordinate);\r\n    //将该点要素添加到矢量数据源中\r\n    self.source.addFeature(new ol.Feature(point));\r\n    // //更改测量提示框的样式，使测量提示框可见\r\n    // self.measureTooltipElement.className = 'tooltip tooltip-static';\r\n    //创建新的浮动测量提示框\r\n    createMeasureTooltip.call(self, evt.coordinate);\r\n    //点击次数增加\r\n    self.count++;\r\n}\r\n\r\n//双击结束绘制\r\n// function onMapDoubleClickCallback(evt) {\r\n//     var self = this;\r\n//     var ol = self.injects.ol;\r\n//     //TODO:提示框\r\n//     //绘制最后一个点\r\n//     pinTip.call(self, evt.coordinate);\r\n//     var point = new ol.geom.Point(evt.coordinate);\r\n//     self.source.addFeature(new ol.Feature(point));\r\n//     //出现close\r\n//     debugger\r\n//     $(self.curTooltip.target).find('.ol-popup-closer').removeClass('hidden')\r\n//     self.curTooltip = null;\r\n//     self.count = 0;\r\n// }\r\n\r\nfunction pinTip(coordinate) {\r\n\r\n    var self = this;\r\n    if (self.count == 0) {\r\n        $(self.curTooltip.target).attr('data-count', self.count).find('.content').empty().append('<span>起点</span>');\r\n    }\r\n    if (!self.curTooltip.lineId) {\r\n        self.curTooltip.lineId = self.curLineId;\r\n    }\r\n    //更改测量提示框的样式，使测量提示框可见\r\n    self.curTooltip.className = 'tooltip tooltip-static';\r\n    self.curTooltip.marker.setPosition(coordinate)\r\n    self.pinToolTips.push(self.curTooltip);\r\n\r\n}\r\n\r\n// //创建提示框 xxxkm 跟着鼠标走的那个 \r\n// function createHelpTooltip() {\r\n\r\n//     var self = this;\r\n//     var container = self.injects.mapContainer;\r\n//     var mapHelper = self.injects.getMapHelper();\r\n\r\n\r\n//     self.helpTooltipElement = container.find(self.options.helpTipSelector)[0]\r\n//     if (!self.helpTooltipElement) {\r\n//         container.append(helpTooltipHtml);//创建帮助提示要素的div\r\n//         self.helpTooltipElement = container.find(self.options.helpTipSelector)[0]\r\n//     }\r\n\r\n//     // //创建一个帮助提示的覆盖标注\r\n//     // var helpTooltip = new ol.Overlay({\r\n//     //     element: self.helpTooltipElement,\r\n//     //     offset: [15, 0],\r\n//     //     positioning: 'center-left'\r\n//     // });\r\n\r\n//     //将测量提示的覆盖标注添加到地图中    \r\n//     self.helpTooltip = mapHelper.addOverlay(0, 0, self.helpTooltipElement, { offset: [0, -15], positioning: 'bottom-center' });\r\n\r\n// }\r\n//创建测量提示框 XXXKM  跟着鼠标走的那个 点击会定下有多个\r\nfunction createMeasureTooltip(x=0, y=0) {\r\n    //创建测量提示框的div\r\n    var self = this;\r\n    var container = self.injects.mapContainer;\r\n    var mapHelper = self.injects.getMapHelper();\r\n\r\n\r\n    var _id = comLib.getRandom();\r\n    container.append(measureTooltipHtml.format({ count: self.count, id: _id, lineId: self.curLineId }));\r\n    var measureTooltipElement = container.find(`${self.options.toolTipSelector}[data-id=${_id}]`)[0];\r\n\r\n    // var measureTooltipElement = container.find(self.options.toolTipSelector)[0]\r\n    // if (!measureTooltipElement) {\r\n    //     container.append(measureTooltipHtml.format({ count: self.count, id: comLib.getRandom(), lineId: self.curLineId }));\r\n    //     self.measureTooltipElement = container.find(self.options.toolTipSelector)[0]\r\n    // }\r\n\r\n    // //创建一个测量提示的覆盖标注\r\n    // var measureTooltip = new ol.Overlay({\r\n    //     element: self.measureTooltipElement,\r\n    //     offset: [0, -15],\r\n    //     positioning: 'bottom-center'\r\n    // });\r\n    //将测量提示的覆盖标注添加到地图中        \r\n    \r\n    self.curTooltip = mapHelper.addOverlay([x, y], measureTooltipElement, { offset: [0, -15], positioning: 'bottom-center' }, { canMutity: true });\r\n    self.curTooltip.lineId = self.curLineId;\r\n}\r\n\r\nexport default tool_measureLength;\r\n\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/olMap/src/mapHelper/control/tool_measureLength.js\n// module id = Swog\n// module chunks = 6","module.exports = \"<div id='toolTipBtn' class=\\\"tooltip tooltip-help hidden\\\">\\r\\n\\r\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/olMap/src/mapHelper/template/helpTooltip.html\n// module id = zkbY\n// module chunks = 5 6 7"],"sourceRoot":""}