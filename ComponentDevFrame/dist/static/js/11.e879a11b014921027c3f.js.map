{"version":3,"sources":["webpack:///./node_modules/olMap/src/mapHelper/control/command_location.js"],"names":["Object","defineProperty","__webpack_exports__","value","$","__WEBPACK_IMPORTED_MODULE_0__common_comLib__","__webpack_require__","__WEBPACK_IMPORTED_MODULE_1__control_baseControl__","__WEBPACK_IMPORTED_MODULE_2__enum_controlType__","command_location","inhertObject","iniDomDisplay","_type","type","this","options","mainType","curType","panel","find","removeClass","siblings","addClass","getMapCenter","call","self","map","injects","getMapHelper","mapExtent","getView","calculateExtent","getSize","point","ol","extent","getCenter","val","address","url","get","result","data","JSON","parse","formatted_address","undefined","mapContainer","controlBarContainer","controlBar","target","pointLayerID","command","init","apply","arguments","active","async","isPanelFirstLoad","mapHelper","on","attr","evt","action","hidePanel","X","Y","clear","zoomToCenter","addPoint","xd","xm","xs","yd","ym","ys","parseFloat","destroy"],"mappings":"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","file":"static/js/11.e879a11b014921027c3f.js","sourcesContent":["import comLib from '../common/comLib'\r\nimport baseControl from '../control/baseControl'\r\nimport controlType from '../enum/controlType'\r\n\r\nvar command_location = comLib.inhertObject(baseControl);\r\n\r\ncommand_location.injects = {\r\n    ol: undefined,\r\n    mapContainer: undefined,  // 地图所在div\r\n    controlBarContainer: undefined, //bar 所在的div\r\n    controlBar: undefined, // bar\r\n    getMapHelper: undefined\r\n}\r\n\r\ncommand_location.options = {\r\n    target: \"locationPanel.html\",\r\n    mainType: \"XY\",\r\n    pointLayerID: \"locationPointLayer\",\r\n    point : [],\r\n    address:\"\"\r\n}\r\n\r\ncommand_location.type = controlType.command;\r\n\r\ncommand_location.init = function (injects, options) {\r\n    baseControl.init.apply(this, arguments);\r\n\r\n}\r\n\r\ncommand_location.active = async function () {\r\n    var self = this;\r\n    self.panel = await baseControl.active.apply(this, arguments);\r\n    var mapHelper = this.injects.getMapHelper();\r\n    var ol = this.injects.ol;\r\n    iniDomDisplay.call(self);\r\n    \r\n    if (self.options.isPanelFirstLoad) {\r\n        bindEvents.call(self);\r\n    }\r\n    // var panel = await this.getTargetTemplatePanel().then()\r\n    \r\n\r\n\r\n}\r\n\r\ncommand_location.destroy = function () {\r\n\r\n}\r\n\r\nfunction bindEvents() {\r\n    var self = this;\r\n    var mapHelper = this.injects.getMapHelper();\r\n    self.panel.on('click', '.changeTypeBtns button', function () {\r\n        var type = $(this).attr('data-target');\r\n        iniDomDisplay.call(self, type);\r\n    })\r\n    mapHelper.map.on('moveend', function(evt){\r\n\r\n        getMapCenter.call(self);\r\n    })\r\n    self.panel.on('click', '[data-action]', function () {\r\n        \r\n        var action = $(this).attr('data-action');\r\n        if (action == \"close\") {\r\n            self.hidePanel();\r\n        } else if (action == \"location\") {\r\n            if (self.curType == \"XY\") {\r\n                var X = self.panel.find('#location_xy_x').val();\r\n                var Y = self.panel.find('#location_xy_y').val();\r\n                mapHelper.clear(self.options.pointLayerID)\r\n                mapHelper.zoomToCenter([X, Y])\r\n                mapHelper.addPoint(self.options.pointLayerID,[X, Y])\r\n            } else if (self.curType == \"DMDZ\") {\r\n                var X = self.panel.find('#location_dingming').val();\r\n                var Y = self.panel.find('#location_dizhi').val();\r\n                mapHelper.clear(self.options.pointLayerID)\r\n                mapHelper.zoomToCenter([X, Y])\r\n                mapHelper.addPoint(self.options.pointLayerID,[X, Y])\r\n                \r\n            }else if (self.curType == \"DMS\") {\r\n                debugger\r\n                var xd = self.panel.find('#location_dms_xd').val();\r\n                var xm = self.panel.find('#location_dms_xm').val() / 60;\r\n                var xs = self.panel.find('#location_dms_xs').val() / 3500;\r\n                var yd = self.panel.find('#location_dms_yd').val();\r\n                var ym = self.panel.find('#location_dms_ym').val() / 60;\r\n                var ys = self.panel.find('#location_dms_ys').val() / 3500;\r\n\r\n                var X = parseFloat(xd) + parseFloat(xm) + parseFloat(xs);\r\n                var Y = parseFloat(yd) + parseFloat(ym) + parseFloat(ys);\r\n                mapHelper.clear(self.options.pointLayerID)\r\n                mapHelper.zoomToCenter([X, Y])\r\n                mapHelper.addPoint(self.options.pointLayerID,[X, Y])\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\n\r\nfunction iniDomDisplay(_type) {\r\n    var self = this;\r\n    var type = _type || self.options.mainType;\r\n    self.curType = type;\r\n    \r\n    self.panel.find(`[data-location-type=${type}]`).removeClass('hidden').siblings('.panel').addClass('hidden')\r\n    self.panel.find(`.changeTypeBtns [data-target=${type}]`).removeClass('is-plain').siblings('button').addClass('is-plain')\r\n    if(_type==\"DMDZ\"){\r\n        getMapCenter.call(self);\r\n    }\r\n\r\n}\r\n //打开标注\r\n        function getMapCenter() {\r\n            var self = this;\r\n            var mapHelper = this.injects.getMapHelper();\r\n            var map=mapHelper.map;\r\n            var mapExtent = map.getView().calculateExtent(map.getSize());\r\n            var point = ol.extent.getCenter(mapExtent) ;\r\n            if(point==self.options.point){\r\n                $(\"#location_dizhi\").val(self.options.address);\r\n            }else{\r\n                self.options.point=point;\r\n                //var url=\"http://api.tianditu.gov.cn/geocoder?postStr={'lon':116.37304,'lat':39.92594,'ver':1}&type=geocode&tk=55f7e166eaeed33da38b5acf129350bb\";\r\n                var url=\"http://api.tianditu.gov.cn/geocoder?postStr={'lon':\"+point[0]+\",'lat':\"+point[1]+\",'ver':1}&type=geocode&tk=55f7e166eaeed33da38b5acf129350bb\";\r\n                $.get(url, function(result){\r\n                        var data=JSON.parse(result).result.formatted_address;\r\n                        self.options.address=data;\r\n                        $(\"#location_dizhi\").val(data);\r\n                });\r\n            }\r\n           \r\n\r\n        }\r\n\r\n\r\nexport default command_location;\r\n\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/olMap/src/mapHelper/control/command_location.js\n// module id = 85Fh\n// module chunks = 11"],"sourceRoot":""}